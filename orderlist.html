<!doctype html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>手机直播商城</title>
    <link rel="stylesheet" href="js/bower_components/sui_mobile/dist/css/sm.min.css">
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/orderlist.css">
    <link rel="stylesheet" href="css/font_icon/iconfont.css">
</head>
<body>
<div class="page-group oderlist">
    <!--//订单列表-->
    <div class="page page-current" id="oderList">
        <div class="content infinite-scroll-bottom" style="height: 100%" data-distance="100">
            <div class="list-block" style="margin-top: 0;margin-bottom: 0">
                <ul class="list-container" style="margin-bottom: 2.8rem">
                    <li style="position: absolute;height: 100%;width: 100%">
                        <div class="none_info text-center">
                            <img src="img/skull.png" alt="">
                            <small>暂时还没有内容哦</small>
                        </div>
                    </li>
                    <!--<li>-->
                        <!--<h3 class="tittle clearfix">-->
                            <!--<span class="pull-left ordernumber">订单编号42354366</span>-->
                            <!--<span class="pull-right nopay">未付款</span>-->
                        <!--</h3>-->
                        <!--<div class="row">-->
                            <!--<div class="col-33">-->
                                <!--<img src="img/push_image.jpg" width="100%">-->
                            <!--</div>-->
                            <!--<div class="col-66 clearfix">-->
                                <!--<div class="discrip">飞利浦（PHILIPS） SHM7110U 可更换耳\头戴式 电脑耳麦 游戏耳机</div>-->
                                <!--<div class="pull-left type">-->
                                    <!--<span>白色</span>-->
                                <!--</div>-->
                                <!--<div class="pull-right text-right cmuch">-->
                                    <!--<div class="much">￥0.01</div>-->
                                    <!--<div class="count">x1</div>-->
                                <!--</div>-->
                            <!--</div>-->
                        <!--</div>-->
                        <!--<p class="introduce text-right">共1件商品 合计：<span style="color: #707070">￥<span class="price">256.00</span></span>（含运费￥0.00）</p>-->
                        <!--<h3 class="text-rigth choice">-->
                            <!--<span class="pay">付款</span>-->
                            <!--<span class="detail">详情</span>-->
                        <!--</h3>-->
                    <!--</li>-->
                    <!--<li>-->
                        <!--<h3 class="tittle clearfix">-->
                            <!--<span class="pull-left ordernumber">订单编号42354366</span>-->
                            <!--<span class="pull-right nopay">未付款</span>-->
                        <!--</h3>-->
                        <!--<div class="row">-->
                            <!--<div class="col-33">-->
                                <!--<img src="img/push_image.jpg" width="100%">-->
                            <!--</div>-->
                            <!--<div class="col-66 clearfix">-->
                                <!--<div class="discrip">飞利浦（PHILIPS） SHM7110U 可更换耳\头戴式 电脑耳麦 游戏耳机</div>-->
                                <!--<div class="pull-left type">-->
                                    <!--<span>白色</span>-->
                                <!--</div>-->
                                <!--<div class="pull-right text-right cmuch">-->
                                    <!--<div class="much">￥0.01</div>-->
                                    <!--<div class="count">x1</div>-->
                                <!--</div>-->
                            <!--</div>-->
                        <!--</div>-->
                        <!--<p class="introduce text-right">共1件商品 合计：<span style="color: #707070">￥<span class="price">256.00</span></span>（含运费￥0.00）</p>-->
                        <!--<h3 class="text-rigth choice">-->
                            <!--<span class="pay">付款</span>-->
                            <!--<span class="detail">详情</span>-->
                        <!--</h3>-->
                    <!--</li>-->
                </ul>
                <section class="back_botton">
                    <ul>
                        <li>
                            <a href="index.html" class="external" style="display: block">
                                <i class="iconfont icon-record"></i>
                                <small>直播</small>
                            </a>
                        </li>
                        <li>
                            <a href="shopcar.html" class="external" style="display: block">
                                <i class="iconfont icon-cart"></i>
                                <small>购物车</small>
                            </a>
                        </li>
                        <li>
                            <a href="javascript:;" class="external" style="display: block">
                                <i class="iconfont icon-news_hot_fill_light"></i>
                                <small>订单</small>
                            </a>
                        </li>
                    </ul>
                </section>
            </div>
        </div>

    </div>
    <!--订单详情-->
    <div class="page payment" id='listDetails' style="overflow-y: auto;">
        <div class="order_info">
            <h4>
                <span>订单状态：待付款</span>
                <span class="pull-right pay_nopay">去支付</span>
            </h4>
            <h4>订单号：1602552585984</h4>
            <h4>下单用户：小明</h4>
            <h4>下单时间：2016-06-01   09:25:36</h4>
        </div>
        <div class="address haveaddress">
            <i class="icon icon_location"></i>
            <div class="box">
                <h3>收货人：<span class="shouhuo">小明</span>
                    <span class="dianhua">1306526541</span></h3>
                <p class="dizhi">重庆市两江新区金开大道西段106号互联网产业园11栋腾讯众创空间</p>
            </div>
        </div>
        <section>
            <h3 class="tittle">商品信息</h3>
            <ul class="payment_list">
                <li style="position: absolute;height: 100%;width: 100%">
                    <div class="none_info text-center">
                        <img src="img/skull.png" alt="">
                        <small>暂时还没有内容哦</small>
                    </div>
                </li>
                <!--<li>-->
                    <!--<a style="display: block" class="row">-->
                    <!--<div class="col-33">-->
                    <!--<img src="img/push_image.jpg" width="100%">-->
                    <!--</div>-->
                    <!--<div class="col-66">-->
                    <!--<div class="discription">-->
                    <!--betu百图时尚荷叶袖绣花衬衫女气质OL五分袖衬衣浅蓝B3M-->
                    <!--</div>-->
                    <!--<div class="info clearfix size">-->
                    <!--<span>蓝色尺码M</span>-->
                    <!--<span class="pull-right">￥159 X1</span>-->
                    <!--</div>-->
                    <!--</div>-->
                    <!--</a>-->
                <!--</li>-->
            </ul>
        </section>
        <section class="value">
            <h3 class="tittle">
                <span>商品信息</span>
                <span class="pull-right">2件</span>
            </h3>
            <h3 class="tittle">
                <span>运费</span>
                <span class="pull-right">免运费</span>
            </h3>
            <h3 class="tittle">
                <span>活动优惠</span>
                <span class="pull-right">-10</span>
            </h3>
        </section>
    </div>
</div>
</body>
<script type='text/javascript' src='//g.alicdn.com/sj/lib/zepto/zepto.min.js' charset='utf-8'></script>
<script type='text/javascript' src='//g.alicdn.com/msui/sm/0.6.2/js/sm.min.js' charset='utf-8'></script>
<script src="js/bower_components/zepto/zepto.touch.js"></script>
<script src="js/bower_components/swiper/dist/js/swiper.jquery.min.js"></script>
<script src="js/webLive.im.js"></script>
<script src="js/bower_components/echo/echo.js"></script>
<script>
    var url = {
        orderListUrl: 'json/orderlist.json'//获取订单详情
        };
    var cloudMail = {
        getOrderList:function (pData) {
        window.liveim.initAjax(url.orderListUrl, 'get', pData, function (result) {
            if (result.code == 0 && result) {
                var html = '';
                $.each(result.data.orderlist, function (index, child) {
                    html += '<li><h3 class="tittle clearfix"><span class="pull-left ordernumber">订单编号：' + child.ordernumber + '</span>' +
                        '<span class="pull-right nopay">'
                        + (function (state) {
                            //付款状态
                            switch (state.orderstate) {
                                case '1':
                                    return '未支付';
                                    break;
                                case '2':
                                    return '<span style="color: #ff9446">待发货</span>';
                                    break;
                                case '3':
                                    return '<span style="color: #ff9446">待收货</span>';
                                    break;
                                case '4':
                                    return '退货';
                                    break;
                                case '5':
                                    return '<span style="color: #ff9446">完成订单</span>';
                                    break;
                                default:
                                    return '';

                            }
                        })(child)
                        + '</span></h3>' + (function (infoList) {
                            //商品信息
                            var html = '';
                            $.each(infoList, function (index, el) {
                                html += '<div class="row"><div class="col-33"><img src="' + el.goodsimg + '" width="100%">' +
                                    '</div><div class="col-66 clearfix"><div class="discrip">' + el.goodsname + '</div>' +
                                    '<div class="pull-left type"><span>' + el.goodstype + '</span></div><div class="pull-right text-right cmuch">' +
                                    '<div class="much">￥' + el.goodsprice + '</div><div class="count">x' + el.goodscount + '</div></div></div></div>'
                            });
                            return html;
                        })(child.goods) + '<p class="introduce text-right">共' + child.goods.length + '件商品 合计：<span style="color: #707070">￥<span class="price">' + child.totalfee + '</span></span>（含运费￥' + child.transportfee + '）</p>' +
                        '<h3 class="text-rigth choice">' +
                        (function (status) {
                            //判断是否支付
                            switch (status.orderstate) {
                                case '1':
                                    return '<span class="pay topay" style="margin-right: .5rem">去支付</span>';
                                case '2':
                                    return '';
                                case '3':
                                    return '';
                                case '4':
                                    return '<span class="returnGoods pay" style="margin-right: .5rem;background-color: #ff9446">申请退款</span>';
                                default:
                                    return '';
                            }
                        })(child) + '<a href="#listDetails" class="detail" data-json=' + JSON.stringify(child) + '>详情</a></h3></li>';
                });
                $('#oderList').find('.list-container').html(html);
            } else {
                $.toast(result.msg);
            }
        })
    },
        //查看订单详情
        showOrderList:function () {
            //填充数据
            $(".oderlist .list-container").on('touchend', '.detail', function () {
                //json里面不能含空格取不到数据
                var fillData = JSON.parse($(this).attr('data-json'));
                $('#listDetails').html('<div class="order_info"><h4>订单状态：' + (function (state) {
                        switch (state) {
                            case '1':
                                return '<span class="pull-right" style="color:#ff5757">待付款</span>';
                                break;
                            case '2':
                                return '<span class="pull-right" style="color: #ff9446">待发货</span>';
                                break;
                            case '3':
                                return '<span class="pull-right" style="color: #ff9446">待收货</span>';
                                break;
                            case '4':
                                return '<span class="pull-right" style="color: #ff5757">可以申请退款</span>';
                                break;
                            case '5':
                                return '<span class="pull-right" style="color: #ff9446">完成订单</span>';
                                break;
                            default:
                                return ''

                        }
                    })(fillData.orderstate) +
                    '</h4><h4>订单号：' + fillData.ordernumber + '</h4><h4>下单用户：' + fillData.craateuser + '</h4><h4>下单时间：' + fillData.createtime + '</h4></div><div class="address haveaddress">' +
                    '<i class="icon icon_location"></i><div class="box"><h3>收货人：<span class="shouhuo">' + fillData.receivename + '</span>' +
                    '<span class="dianhua">1306526541</span></h3><p class="dizhi">' + fillData.receiveaddress + '</p></div></div>' +
                    '<section><h3 class="tittle">商品信息</h3><ul class="payment_list">' + (function (storeList) {
                        var html = '';
                        $.each(storeList, function (index, child) {
                            html += '<li><a style="display: block" class="row"><div class="col-33"><img src="' + child.goodsimg + '" width="100%">' +
                                '</div><div class="col-66"><div class="discription">' + child.goodsname + '</div>' +
                                '<div class="info clearfix"><span class="size">' + child.goodstype + '</span><span class="pull-right" style="margin-right: .5rem;color:#505050;">￥' + child.goodsprice + ' X' + child.goodscount + '</span></div></div></a></li>'
                        });
                        return html;
                    })(fillData.goods) + '</ul></section>' +
                    '<section class="value"><h3 class="tittle"><span>商品信息</span><span class="pull-right">' + fillData.goods.length + '件</span>' +
                    '</h3><h3 class="tittle"><span>运费</span><span class="pull-right">' + fillData.transportfee + '</span></h3><h3 class="tittle">' +
                    '<span>活动优惠</span><span class="pull-right">-10</span></h3></section>'
                )

            });
            //判断付款
            $('.list-container').on('touchend', '.choice .topay', function () {
                var data = JSON.parse($(this).siblings().attr('data-json'));
                cloudMail.toPay({orderid: data.orderid})
            });
            //判断退货
            $('.list-container').on('touchend', '.choice .returnGoods', function () {
                var self = this;
                $.confirm('确定申请退款吗?', function () {
                    var data = JSON.parse($(self).siblings().attr('data-json'));
                    cloudMail.returGoods({orderid: data.orderid})
                });
            });
        }
    };
    $(function () {
        cloudMail.getOrderList();
        cloudMail.showOrderList();
    })
</script>
</html>